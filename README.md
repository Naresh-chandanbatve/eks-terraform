# Kubernetes EKS + Terraform + Helm Deployment with NGINX Ingress & Selfâ€‘Signed TLS

This project provides an endâ€‘toâ€‘end automated production ready workflow to provision an **AWS EKS cluster using Terraform** and deploy Kubernetes applications using **Helm**, **NGINX Ingress**, and **Certâ€‘Manager** with selfâ€‘signed TLS certificates.

It includes:

* Full Terraform EKS infrastructure setup
* Helmâ€‘based deployment for nginx app
* NGINX Ingress Controller installation
* Certâ€‘Manager with a selfâ€‘signed ClusterIssuer
* Dynamic ELB hostname injection into Ingress
* Automatic HTTPS configuration using TLS secrets

---

## Features

### EKS cluster provisioning using Terraform

* VPC, private/public subnets
* Managed node groups
* Helmâ€‘based nginx Deployment
* Configurable values.yaml
* Full HTTPS with Certâ€‘Manager
* Selfâ€‘signed ClusterIssuer
* NGINX Ingress Controller
* AWS LoadBalancer created automatically

---

## Project Structure

```
â”œâ”€â”€ envs/
â”‚   â””â”€â”€ dev/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ backend.tf
â”‚       â”œâ”€â”€ provider.tf
â”‚       â””â”€â”€ variables.tf

â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ eks/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â””â”€â”€ variables.tf
â”‚   â””â”€â”€ vpc/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ outputs.tf
â”‚       â””â”€â”€ variables.tf

â”œâ”€â”€ helm/
â”‚   â”œâ”€â”€ charts/
â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”œâ”€â”€ values.yaml
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â”œâ”€â”€ ingress.yaml
â”‚       â”œâ”€â”€ httproute.yaml
â”‚       â”œâ”€â”€ hpa.yaml
â”‚       â””â”€â”€ serviceaccount.yaml

â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ deploy.sh

â”œâ”€â”€ selfsigned.yaml
â”œâ”€â”€ .pre-commit-config.yaml
â”œâ”€â”€ .terraform-version

```

---

## Terraform Installation & Setup

### Requirements
* [Terraform v1.8.5](https://developer.hashicorp.com/terraform/install)
* [kubectl](https://kubernetes.io/docs/tasks/tools/)
* [Helm](https://helm.sh/docs/intro/install/)
* AWS Access Key & Secret Key
* [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)

### Install pre-commit hook (optional can be sckipped if not production)
```bash
pip install pre-commit
python -m pre_commit install
```

### stable terraform version in .terraform-version
```
1.8.5
```

### 1. Initialize Terraform

```bash
git clone https://github.com/Naresh-chandanbatve/eks-terraform.git
cd eks-terraform
terraform init
```

### 2. Validate the configuration

```bash
terraform validate
```

### 3. Provision the EKS cluster

```bash
terraform apply -auto-approve
```

### 4. Configure kubectl

Terraform output will include:

```
aws eks update-kubeconfig --region <region> --name <cluster_name>
```

Run:

```bash
aws eks update-kubeconfig --region eu-north-1 --name dev-eks-cluster
```

Verify:

```bash
kubectl get nodes
```

---

## Helm Installation & Setup

### Install NGINX Ingress Controller

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install nginx ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace
```

### Install Certâ€‘Manager

```bash
helm repo add jetstack https://charts.jetstack.io
helm upgrade --install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --set installCRDs=true
```

### Apply Selfâ€‘Signed ClusterIssuer

```bash
kubectl apply -f selfsigned.yaml
```

### Run deploy script

```bash
./deploy.sh
```

---

## Accessing the application 

Open in browser:

```
https://<AWS-ELB-HOSTNAME>
```

TLS is automatically generated by Certâ€‘Manager.

---

## ğŸ“œ License

MIT License

---

## ğŸ¤ Contributing

Pull requests and enhancements are welcome!
