# Nginx app Deployment on EKS cluster using Terrfaorm, Ingress and Helm with Selfâ€‘Signed TLS using Cert-Manager

This project provides an endâ€‘toâ€‘end automated production ready workflow to provision an **AWS EKS cluster using Terraform** and deploy nginx Kubernetes application using **Helm**, **NGINX Ingress**, and **Certâ€‘Manager** with selfâ€‘signed TLS certificates.

This project sets up an **EKS cluster** using **Terraform** and deploys an NGINX application using **Helm**, **Ingress**, and **Cert-Manager** with self-signed TLS. It provides a straightforward, ready to use workflow from cluster provisioning to application deployment.

It includes:

- Full Terraform EKS infrastructure setup
- Helmâ€‘based deployment for nginx app
- NGINX Ingress Controller installation
- Certâ€‘Manager with a selfâ€‘signed ClusterIssuer
- Dynamic ELB hostname injection into Ingress
- Automatic HTTPS configuration using TLS secrets
- supports any public or private registries

---

## Project Structure

```
â”œâ”€â”€ envs/
â”‚   â””â”€â”€ dev/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ backend.tf
â”‚       â”œâ”€â”€ provider.tf
â”‚       â””â”€â”€ variables.tf

â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ eks/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â””â”€â”€ variables.tf
â”‚   â””â”€â”€ vpc/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ outputs.tf
â”‚       â””â”€â”€ variables.tf

â”œâ”€â”€ helm/
â”‚   â”œâ”€â”€ charts/
â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”œâ”€â”€ values.yaml
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â”œâ”€â”€ ingress.yaml
â”‚       â”œâ”€â”€ httproute.yaml
â”‚       â”œâ”€â”€ hpa.yaml
â”‚       â””â”€â”€ serviceaccount.yaml

â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ deploy.sh

â”œâ”€â”€ selfsigned.yaml
â”œâ”€â”€ .pre-commit-config.yaml
â”œâ”€â”€ .terraform-version

```

---

## Deployment steps

### Requirements

- [Terraform v1.8.5](https://developer.hashicorp.com/terraform/install)
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [Helm](https://helm.sh/docs/intro/install/)
- AWS Access Key & Secret Key
- [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)

### Install pre-commit hook (optional can be sckipped if not production)

```bash
pip install pre-commit
python -m pre_commit install
```

### configure AWS cli

```bash
aws configure
```

paste AWS access id and secret

### Edit terraform values based on your need

```
cp envs/dev/terraform.tfvars.example envs/dev/terraform.tfvars
```

### stable terraform version in .terraform-version

```
1.8.5
```

### Initialize Terraform

```bash
git clone https://github.com/Naresh-chandanbatve/eks-terraform.git
cd eks-terraform
terraform init
```

### Validate the configuration

```bash
terraform validate
```

### Provision the EKS cluster

```bash
terraform apply -auto-approve
```

### Configure kubectl

Terraform output will include:

```
aws eks update-kubeconfig --region <region> --name <cluster_name>
```

Run:

```bash
aws eks update-kubeconfig --region eu-north-1 --name dev-eks-cluster
```

Verify:

```bash
kubectl get nodes
```

---

### Install NGINX Ingress Controller

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install nginx ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace
```

### Install Certâ€‘Manager

```bash
helm repo add jetstack https://charts.jetstack.io
helm upgrade --install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --set installCRDs=true
```

### Apply Selfâ€‘Signed ClusterIssuer

```bash
kubectl apply -f selfsigned.yaml
```

if you are planning to use in production then selfsigned not recommended, you can use Let's Encrypt cluster issuer.

### Edit values.yaml

- Edit values.yaml file based on your needs.
- Here we have used simple nginx image you can modify it to your own image supports any public and private registries.
- If using private registry create k8s secret using

```
kubectl create secret docker-registry registry-secret \
  --docker-server=<REGISTRY_URL> \
  --docker-username=<USERNAME> \
  --docker-password=<PASSWORD> \
  --docker-email=<EMAIL>
```

### Run deploy script

```bash
./deploy.sh
```

---

## Accessing the application

Open in browser:

```
https://<AWS-ELB-HOSTNAME>
```

TLS is automatically generated by Certâ€‘Manager.

---

## ğŸ“œ License

MIT License

---

## ğŸ¤ Contributing

Pull requests and enhancements are always welcomed!
